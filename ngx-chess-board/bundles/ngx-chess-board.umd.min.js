!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("lodash"),require("rxjs"),require("@angular/cdk/drag-drop")):"function"==typeof define&&define.amd?define("ngx-chess-board",["exports","@angular/core","@angular/common","lodash","rxjs","@angular/cdk/drag-drop"],t):t((e=e||self)["ngx-chess-board"]={},e.ng.core,e.ng.common,e.lodash,e.rxjs,e.ng.cdk["drag-drop"])}(this,(function(e,t,i,o,r,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function a(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function c(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}c((o=o.apply(e,t||[])).next())}))}function h(e,t){var i,o,r,s,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,o=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!(r=(r=n.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){n.label=s[1];break}if(6===s[0]&&n.label<r[1]){n.label=r[1],r=s;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(s);break}r[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],o=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var d={WHITE:0,BLACK:1};d[d.WHITE]="WHITE",d[d.BLACK]="BLACK";var l=function(e,t,i,o,r){this.checkPoints=[],this.color=t,this.image=i,this.point=e,this.relValue=o,this.board=r};var p=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e&&this.row===e.row&&this.col===e.col},e.prototype.hasCoordsEqual=function(e,t){return e&&t&&this.row===e&&this.col===t},e}();var u=function(e){function t(t,i,o,r){var s=e.call(this,t,i,o,5,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8&&this.board.isFieldEmpty(o,i);++o)e.push(new p(o,i));for(o=t-1;o>=0&&this.board.isFieldEmpty(o,i);--o)e.push(new p(o,i));for(var r=i-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new p(t,r));for(r=i+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new p(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(o=t-1;o>=0;--o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(var r=i-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=i+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o)if(this.board.isFieldEmpty(o,i))e.push(new p(o,i));else if(!(this.board.getPieceByField instanceof b)){e.push(new p(o,i));break}for(o=t-1;o>=0;--o)if(this.board.isFieldEmpty(o,i))e.push(new p(o,i));else if(!(this.board.getPieceByField instanceof b)){e.push(new p(o,i));break}for(var r=i-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new p(t,r));else if(!(this.board.getPieceByField instanceof b)){e.push(new p(t,r));break}for(r=i+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new p(t,r));else if(!(this.board.getPieceByField instanceof b)){e.push(new p(t,r));break}return e},t}(l);var b=function(e){function t(t,i,o,r){var s=e.call(this,t,i,o,0,r)||this;return s.castledAlready=!1,s.shortCastled=!1,s.longCastled=!1,s.isCastling=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;if(this.board.isFieldEmpty(t,i-1)&&!this.board.isFieldUnderAttack(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t,i-1)),this.board.isFieldEmpty(t,i+1)&&!this.board.isFieldUnderAttack(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t,i+1)),this.board.isFieldEmpty(t+1,i)&&!this.board.isFieldUnderAttack(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i)),this.board.isFieldEmpty(t-1,i)&&!this.board.isFieldUnderAttack(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i)),this.board.isFieldEmpty(t-1,i-1)&&!this.board.isFieldUnderAttack(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i-1)),this.board.isFieldEmpty(t-1,i+1)&&!this.board.isFieldUnderAttack(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i+1)),this.board.isFieldEmpty(t+1,i-1)&&!this.board.isFieldUnderAttack(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i-1)),this.board.isFieldEmpty(t+1,i+1)&&!this.board.isFieldUnderAttack(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i+1)),!this.isMovedAlready){for(var o=!0,r=i-1;r>0;--r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){o=!1;break}if(o&&this.board.getPieceByField(t,0)){var s=this.board.getPieceByField(t,0);s instanceof u&&(s.isMovedAlready||e.push(new p(t,i-2)))}var n=!0;for(r=i+1;r<7;++r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){n=!1;break}if(n&&this.board.getPieceByField(t,7)){var a=this.board.getPieceByField(t,7);a instanceof u&&(a.isMovedAlready||e.push(new p(t,i+2)))}}return e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldTakenByEnemy(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t,i-1)),this.board.isFieldTakenByEnemy(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t,i+1)),this.board.isFieldTakenByEnemy(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i)),this.board.isFieldTakenByEnemy(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i)),this.board.isFieldTakenByEnemy(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i-1)),this.board.isFieldTakenByEnemy(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i+1)),this.board.isFieldTakenByEnemy(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i-1)),this.board.isFieldTakenByEnemy(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&!this.board.isFieldUnderAttack(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldTakenByEnemy(t,i-1,this.color)&&e.push(new p(t,i-1)),this.board.isFieldTakenByEnemy(t,i+1,this.color)&&e.push(new p(t,i+1)),this.board.isFieldTakenByEnemy(t+1,i,this.color)&&e.push(new p(t+1,i)),this.board.isFieldTakenByEnemy(t-1,i,this.color)&&e.push(new p(t-1,i)),this.board.isFieldTakenByEnemy(t-1,i-1,this.color)&&e.push(new p(t-1,i-1)),this.board.isFieldTakenByEnemy(t-1,i+1,this.color)&&e.push(new p(t-1,i+1)),this.board.isFieldTakenByEnemy(t+1,i-1,this.color)&&e.push(new p(t+1,i-1)),this.board.isFieldTakenByEnemy(t+1,i+1,this.color)&&e.push(new p(t+1,i+1)),e},t}(l);var f=function(){function e(){}return e.WHITE_KING="&#x2654;",e.WHITE_QUEEN="&#x2655;",e.WHITE_KNIGHT="&#x2658;",e.WHITE_ROOK="&#x2656;",e.WHITE_PAWN="&#x2659;",e.WHITE_BISHOP="&#x2657;",e.BLACK_KING="&#x265A;",e.BLACK_QUEEN="&#x265B;",e.BLACK_KNIGHT="&#x265E;",e.BLACK_ROOK="&#x265C;",e.BLACK_PAWN="&#x265F;",e.BLACK_BISHOP="&#x265D;",e}();var y=function(e){function t(t,i,o,r){return e.call(this,t,i,o,9,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0&&this.board.isFieldEmpty(o,r);--o,--r)e.push(new p(o,r));for(o=t-1,r=i+1;o>=0&&r<8&&this.board.isFieldEmpty(o,r);--o,++r)e.push(new p(o,r));for(o=t+1,r=i-1;o<8&&r>=0&&this.board.isFieldEmpty(o,r);++o,--r)e.push(new p(o,r));for(o=t+1,r=i+1;o<8&&r<8&&this.board.isFieldEmpty(o,r);++o,++r)e.push(new p(o,r));for(o=t+1;o<8&&this.board.isFieldEmpty(o,i);++o)e.push(new p(o,i));for(o=t-1;o>=0&&this.board.isFieldEmpty(o,i);--o)e.push(new p(o,i));for(r=i-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new p(t,r));for(r=i+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new p(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1;o<8;++o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(o=t-1;o>=0;--o){if(this.board.isFieldTakenByEnemy(o,i,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,i));break}if(!this.board.isFieldEmpty(o,i))break}for(r=i-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=i+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t+1;o<8;++o)if(this.board.isFieldEmpty(o,i))e.push(new p(o,i));else if(!(this.board.getPieceByField(o,i)instanceof b)){e.push(new p(o,i));break}for(o=t-1;o>=0;--o)if(this.board.isFieldEmpty(o,i))e.push(new p(o,i));else if(!(this.board.getPieceByField(o,i)instanceof b)){e.push(new p(o,i));break}for(var r=i-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new p(t,r));else if(!(this.board.getPieceByField(t,r)instanceof b)){e.push(new p(t,r));break}for(r=i+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new p(t,r));else if(!(this.board.getPieceByField(t,r)instanceof b)){e.push(new p(t,r));break}for(o=t-1,r=i-1;o>=0&&r>=0;--o,--r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}return e},t}(l),w=function(e){function t(t,i,o,r){var s=e.call(this,t,i,o,1,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?this.board.isFieldEmpty(t-1,i)&&(e.push(new p(t-1,i)),!this.isMovedAlready&&this.board.isFieldEmpty(t-2,i)&&e.push(new p(t-2,i))):/*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/this.board.isFieldEmpty(t+1,i)&&(e.push(new p(t+1,i)),!this.isMovedAlready&&this.board.isFieldEmpty(t+2,i)&&e.push(new p(t+2,i))),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?(this.board.isFieldTakenByEnemy(t-1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i-1)),this.board.isFieldTakenByEnemy(t-1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i+1))):(this.board.isFieldTakenByEnemy(t+1,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i-1)),this.board.isFieldTakenByEnemy(t+1,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i+1))),this.board.enPassantPoint&&this.board.enPassantPiece.color===(this.color===d.WHITE?d.BLACK:d.WHITE)&&t===this.board.enPassantPiece.point.row&&1===Math.abs(this.board.enPassantPiece.point.col-i)&&e.push(this.board.enPassantPoint),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return!this.board.reverted&&this.color===d.WHITE||this.board.reverted&&this.color===d.BLACK?(e.push(new p(t-1,i-1)),e.push(new p(t-1,i+1))):(e.push(new p(t+1,i-1)),e.push(new p(t+1,i+1))),e},t}(l);var v=function(e){function t(t,i,o,r){var s=e.call(this,t,i,o,3,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldEmpty(t-2,i-1)&&e.push(new p(t-2,i-1)),this.board.isFieldEmpty(t-2,i+1)&&e.push(new p(t-2,i+1)),this.board.isFieldEmpty(t-1,i-2)&&e.push(new p(t-1,i-2)),this.board.isFieldEmpty(t-1,i+2)&&e.push(new p(t-1,i+2)),this.board.isFieldEmpty(t+1,i-2)&&e.push(new p(t+1,i-2)),this.board.isFieldEmpty(t+1,i+2)&&e.push(new p(t+1,i+2)),this.board.isFieldEmpty(t+2,i-1)&&e.push(new p(t+2,i-1)),this.board.isFieldEmpty(t+2,i+1)&&e.push(new p(t+2,i+1)),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,i=this.point.col;return this.board.isFieldTakenByEnemy(t-2,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-2,i-1)),this.board.isFieldTakenByEnemy(t-2,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-2,i+1)),this.board.isFieldTakenByEnemy(t-1,i-2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i-2)),this.board.isFieldTakenByEnemy(t-1,i+2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t-1,i+2)),this.board.isFieldTakenByEnemy(t+1,i-2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i-2)),this.board.isFieldTakenByEnemy(t+1,i+2,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+1,i+2)),this.board.isFieldTakenByEnemy(t+2,i-1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+2,i-1)),this.board.isFieldTakenByEnemy(t+2,i+1,this.color===d.WHITE?d.BLACK:d.WHITE)&&e.push(new p(t+2,i+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,i=this.point.col;return e.push(new p(t-2,i-1)),e.push(new p(t-2,i+1)),e.push(new p(t-1,i-2)),e.push(new p(t-1,i+2)),e.push(new p(t+1,i-2)),e.push(new p(t+1,i+2)),e.push(new p(t+2,i-1)),e.push(new p(t+2,i+1)),e},t}(l);var E=function(e){function t(t,i,o,r){return e.call(this,t,i,o,3,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0&&this.board.isFieldEmpty(o,r);--o,--r)e.push(new p(o,r));for(o=t-1,r=i+1;o>=0&&r<8&&this.board.isFieldEmpty(o,r);--o,++r)e.push(new p(o,r));for(o=t+1,r=i-1;o<8&&r>=0&&this.board.isFieldEmpty(o,r);++o,--r)e.push(new p(o,r));for(o=t+1,r=i+1;o<8&&r<8&&this.board.isFieldEmpty(o,r);++o,++r)e.push(new p(o,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r){if(this.board.isFieldTakenByEnemy(o,r,this.color===d.WHITE?d.BLACK:d.WHITE)){e.push(new p(o,r));break}if(!this.board.isFieldEmpty(o,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,i=this.point.col,o=t-1,r=i-1;o>=0&&r>=0;--o,--r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t-1,r=i+1;o>=0&&r<8;--o,++r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t+1,r=i-1;o<8&&r>=0;++o,--r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}for(o=t+1,r=i+1;o<8&&r<8;++o,++r)if(this.board.isFieldEmpty(o,r))e.push(new p(o,r));else if(!(this.board.getPieceByField(o,r)instanceof b)){e.push(new p(o,r));break}return e},t}(l),C=function(){function e(){this.pieces=[],this.enPassantPoint=null,this.enPassantPiece=null,this.lastMoveSrc=null,this.lastMoveDest=null,this.possibleCaptures=[],this.possibleMoves=[],this.currentWhitePlayer=!0,this.reverted=!1,this.fullMoveCount=1,this.board=[];for(var e=0;e<8;++e){this.board[e]=[];for(var t=0;t<8;++t)this.board[e][t]=0}}return e.prototype.isXYInPossibleMoves=function(e,t){return this.possibleMoves.some((function(i){return i.row===e&&i.col===t}))},e.prototype.isXYInPossibleCaptures=function(e,t){return this.possibleCaptures.some((function(i){return i.row===e&&i.col===t}))},e.prototype.isXYInSourceMove=function(e,t){return this.lastMoveSrc&&this.lastMoveSrc.row===e&&this.lastMoveSrc.col===t},e.prototype.isXYInDestMove=function(e,t){return this.lastMoveDest&&this.lastMoveDest.row===e&&this.lastMoveDest.col===t},e.prototype.isXYInActiveMove=function(e,t){return this.activePiece&&this.activePiece.point.row===e&&this.activePiece.point.col===t},e.prototype.isPointInPossibleMoves=function(e){return this.possibleMoves.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.isPointInPossibleCaptures=function(e){return this.possibleCaptures.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.reset=function(){this.lastMoveDest=null,this.lastMoveSrc=null,this.whiteKingChecked=!1,this.blackKingChecked=!1,this.possibleCaptures=[],this.possibleMoves=[],this.activePiece=null,this.reverted=!1,this.currentWhitePlayer=!0,this.enPassantPoint=null,this.enPassantPiece=null,this.fullMoveCount=1,this.calculateFEN()},e.prototype.reverse=function(){this.reverted=!this.reverted,this.activePiece=null,this.possibleMoves=[],this.possibleCaptures=[];for(var e=0;e<this.pieces.length;++e)this.reversePoint(this.pieces[e].point);this.reversePoint(this.lastMoveSrc),this.enPassantPoint&&this.enPassantPiece&&this.reversePoint(this.enPassantPoint)},e.prototype.reversePoint=function(e){e&&(e.row=Math.abs(e.row-7),e.col=Math.abs(e.col-7))},e.prototype.clone=function(){return o.cloneDeep(this)},e.prototype.isFieldTakenByEnemy=function(e,t,i){return!(e>7||e<0||t>7||t<0)&&this.pieces.some((function(o){return o.point.col===t&&o.point.row===e&&o.color===i}))},e.prototype.isFieldEmpty=function(e,t){return!(e>7||e<0||t>7||t<0)&&!this.pieces.some((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.isFieldUnderAttack=function(e,t,i){return this.pieces.filter((function(e){return e.color===i})).some((function(i){return i.getCoveredFields().some((function(i){return i.col===t&&i.row===e}))}))},e.prototype.getPieceByField=function(e,t){if(!this.isFieldEmpty(e,t))return this.pieces.find((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.isKingInCheck=function(e,t){var i=t.find((function(t){return t.color===e&&t instanceof b}));return!!i&&t.some((function(t){return t.getPossibleCaptures().some((function(e){return e.col===i.point.col&&e.row===i.point.row}))&&t.color!==e}))},e.prototype.getKingByColor=function(e){return this.pieces.find((function(t){return t instanceof b&&t.color===e}))},e.prototype.getCastleFENString=function(e){var t=this.getKingByColor(e);if(t.isMovedAlready)return"";var i="",o=this.getPieceByField(t.point.row,0),r=this.getPieceByField(t.point.row,7);return r instanceof u&&r.color===e&&(r.isMovedAlready||(i+=this.reverted?"q":"k")),o instanceof u&&o.color===e&&(o.isMovedAlready||(i+=this.reverted?"k":"q")),i=i.split("").sort().join(""),e===d.BLACK?i:i.toUpperCase()},e.prototype.getEnPassantFENString=function(){return this.enPassantPoint?this.reverted?String.fromCharCode(104-this.enPassantPoint.col)+(this.enPassantPoint.row+1):String.fromCharCode(97+this.enPassantPoint.col)+(Math.abs(this.enPassantPoint.row-7)+1):"-"},e.prototype.calculateFEN=function(){for(var e="",t=function(t){for(var o=0,r=function(r){var s=i.pieces.find((function(e){return e.point.col===r&&e.point.row===t}));s?(o>0&&(e+=o,o=0),s instanceof u?e+=s.color===d.BLACK?"r":"R":s instanceof v?e+=s.color===d.BLACK?"n":"N":s instanceof E?e+=s.color===d.BLACK?"b":"B":s instanceof y?e+=s.color===d.BLACK?"q":"Q":s instanceof b?e+=s.color===d.BLACK?"k":"K":s instanceof w&&(e+=s.color===d.BLACK?"p":"P")):++o},s=0;s<8;++s)r(s);o>0&&(e+=o),e+="/"},i=this,o=0;o<8;++o)t(o);e=e.substr(0,e.length-1),this.reverted&&(e=e.split("").reverse().join("")),e+=" "+(this.currentWhitePlayer?"w":"b");var r=this.getCastleFENString(d.WHITE)+this.getCastleFENString(d.BLACK);r||(r="-"),e+=" "+r,e+=" "+this.getEnPassantFENString(),e+=" 0",e+=" "+this.fullMoveCount,this.fen=e},e.prototype.isXYInPointSelection=function(e,t){return!1},e}();var g=function(){function e(){}return e.willMoveCauseCheck=function(e,t,i,o,r,s){var n=s.getPieceByField(t,i),a=s.getPieceByField(o,r);n&&(n.point.row=o,n.point.col=r),a&&(s.pieces=s.pieces.filter((function(e){return e!==a})));var c=s.isKingInCheck(e,s.pieces);return n&&(n.point.col=i,n.point.row=t),a&&s.pieces.push(a),c},e.format=function(e,t,i){if(i){var o=104-e.col,r=104-t.col;return String.fromCharCode(o)+(e.row+1)+String.fromCharCode(r)+(t.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)+String.fromCharCode(t.col+97)+(Math.abs(t.row-7)+1)},e}(),I=function(){function e(){this.componentMethodCallSource=new r.Subject,this.componentMethodCalled$=this.componentMethodCallSource.asObservable()}return e.prototype.reset=function(){this.componentMethodCallSource.next()},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var P=function(e){this.piece=e};var m=function(e){function t(t,i,o,r){var s=e.call(this,t)||this;return s.pointClicked=i,s.color=o,s.board=r,s}return a(t,e),t.prototype.getPossibleCaptures=function(){var e=this;return this.piece.getPossibleCaptures().filter((function(t){return!g.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t.prototype.getPossibleMoves=function(){var e=this;return this.piece.getPossibleMoves().filter((function(t){return!g.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t}(P);var k=function(){function e(){this.moves=[]}return e.prototype.addMove=function(e){this.moves.push(e)},e.prototype.getMoves=function(){return this.moves},e.prototype.pop=function(){return this.moves.pop()},e.prototype.isEmpty=function(){return 0===this.moves.length},e.prototype.clear=function(){this.moves=[]},e}();var T=function(e){this.board=e};var B=function(e,t,i){this.move=e,this.piece=t,this.color=i};var F=function(){function e(){this.historyMoves=[]}return e.prototype.addMove=function(e){this.historyMoves.push(e)},e.prototype.pop=function(){return this.historyMoves.pop()},e.prototype.getAll=function(){return this.historyMoves},e.prototype.clear=function(){this.historyMoves=[]},e}();var A=function(){function e(){}return e.DEFAULT_DARK_TILE_COLOR="rgb(97, 84, 61)",e.DEFAULT_LIGHT_TILE_COLOR="#BAA378",e.DEFAULT_SIZE=400,e.MIN_BOARD_SIZE=100,e.MAX_BOARD_SIZE=4e3,e}();var H=function(){function e(){this._xCoords=["a","b","c","d","e","f","g","h"],this._yCoords=[8,7,6,5,4,3,2,1]}return e.prototype.reverse=function(){this._xCoords=this._xCoords.reverse(),this._yCoords=this._yCoords.reverse()},Object.defineProperty(e.prototype,"xCoords",{get:function(){return this._xCoords},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yCoords",{get:function(){return this._yCoords},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.init()},e.prototype.init=function(){this._xCoords=["a","b","c","d","e","f","g","h"],this._yCoords=[8,7,6,5,4,3,2,1]},e}();var W=function(){function e(e){this.board=e}return e.prototype.addPieces=function(){this.board.pieces=[];for(var e=0;e<8;++e)this.board.pieces.push(new w(new p(1,e),d.BLACK,f.BLACK_PAWN,this.board));this.board.pieces.push(new u(new p(0,0),d.BLACK,f.BLACK_ROOK,this.board)),this.board.pieces.push(new v(new p(0,1),d.BLACK,f.BLACK_KNIGHT,this.board)),this.board.pieces.push(new E(new p(0,2),d.BLACK,f.BLACK_BISHOP,this.board)),this.board.pieces.push(new y(new p(0,3),d.BLACK,f.BLACK_QUEEN,this.board)),this.board.pieces.push(new b(new p(0,4),d.BLACK,f.BLACK_KING,this.board)),this.board.pieces.push(new E(new p(0,5),d.BLACK,f.BLACK_BISHOP,this.board)),this.board.pieces.push(new v(new p(0,6),d.BLACK,f.BLACK_KNIGHT,this.board)),this.board.pieces.push(new u(new p(0,7),d.BLACK,f.BLACK_ROOK,this.board));for(e=0;e<8;++e)this.board.pieces.push(new w(new p(6,e),d.WHITE,f.WHITE_PAWN,this.board));this.board.pieces.push(new u(new p(7,0),d.WHITE,f.WHITE_ROOK,this.board)),this.board.pieces.push(new v(new p(7,1),d.WHITE,f.WHITE_KNIGHT,this.board)),this.board.pieces.push(new E(new p(7,2),d.WHITE,f.WHITE_BISHOP,this.board)),this.board.pieces.push(new y(new p(7,3),d.WHITE,f.WHITE_QUEEN,this.board)),this.board.pieces.push(new b(new p(7,4),d.WHITE,f.WHITE_KING,this.board)),this.board.pieces.push(new E(new p(7,5),d.WHITE,f.WHITE_BISHOP,this.board)),this.board.pieces.push(new v(new p(7,6),d.WHITE,f.WHITE_KNIGHT,this.board)),this.board.pieces.push(new u(new p(7,7),d.WHITE,f.WHITE_ROOK,this.board)),this.board.calculateFEN()},e.prototype.loadFEN=function(e){if(!e)throw Error("Incorrect FEN provided");this.board.reverted=!1,this.board.pieces=[];for(var t=e.split("/"),i=0;i<8;++i)for(var o=0,r=0;r<8;++r){var s=t[i].charAt(r);if(s.match(/[0-9]/))o+=Number(s);else{switch(s){case"r":this.board.pieces.push(new u(new p(i,o),d.BLACK,f.BLACK_ROOK,this.board));break;case"n":this.board.pieces.push(new v(new p(i,o),d.BLACK,f.BLACK_KNIGHT,this.board));break;case"b":this.board.pieces.push(new E(new p(i,o),d.BLACK,f.BLACK_BISHOP,this.board));break;case"q":this.board.pieces.push(new y(new p(i,o),d.BLACK,f.BLACK_QUEEN,this.board));break;case"k":this.board.pieces.push(new b(new p(i,o),d.BLACK,f.BLACK_KING,this.board));break;case"p":((n=new w(new p(i,o),d.BLACK,f.BLACK_PAWN,this.board)).color===d.BLACK&&1!==n.point.row||n.color===d.WHITE&&6!==n.point.row)&&(n.isMovedAlready=!0),this.board.pieces.push(n);break;case"R":this.board.pieces.push(new u(new p(i,o),d.WHITE,f.WHITE_ROOK,this.board));break;case"N":this.board.pieces.push(new v(new p(i,o),d.WHITE,f.WHITE_KNIGHT,this.board));break;case"B":this.board.pieces.push(new E(new p(i,o),d.WHITE,f.WHITE_BISHOP,this.board));break;case"Q":this.board.pieces.push(new y(new p(i,o),d.WHITE,f.WHITE_QUEEN,this.board));break;case"K":this.board.pieces.push(new b(new p(i,o),d.WHITE,f.WHITE_KING,this.board));break;case"P":var n;((n=new w(new p(i,o),d.WHITE,f.WHITE_PAWN,this.board)).color===d.BLACK&&1!==n.point.row||n.color===d.WHITE&&6!==n.point.row)&&(n.isMovedAlready=!0),this.board.pieces.push(n)}++o}}this.setCurrentPlayer(e),this.setCastles(e),this.setEnPassant(e),this.setFullMoveCount(e)},e.prototype.setCurrentPlayer=function(e){if(e){var t=e.split(" ");this.board.currentWhitePlayer="w"===t[1]}},e.prototype.setBoard=function(e){this.board=e},e.prototype.setCastles=function(e){if(e){var t=e.split(" ")[2];t.includes("K")||this.setRookAlreadyMoved(d.WHITE,7),t.includes("Q")||this.setRookAlreadyMoved(d.WHITE,0),t.includes("k")||this.setRookAlreadyMoved(d.BLACK,7),t.includes("q")||this.setRookAlreadyMoved(d.BLACK,0)}},e.prototype.setFullMoveCount=function(e){},e.prototype.setEnPassant=function(e){if(e&&"-"===e.split(" ")[3])return},e.prototype.setRookAlreadyMoved=function(e,t){this.board.pieces.find((function(i){return i.color===e&&i instanceof u&&i.point.col===t})).isMovedAlready=!0},e}();var K=function(){function e(){this.selectedIndex=1}return e.prototype.open=function(e){this.onCloseCallback=e,this.modal.nativeElement.style.display="block"},e.prototype.close=function(){return c(this,void 0,void 0,(function(){return h(this,(function(e){return this.onCloseCallback(this.selectedIndex),this.modal.nativeElement.style.display="none",[2]}))}))},e.prototype.changeSelection=function(e){this.selectedIndex=e},e.decorators=[{type:t.Component,args:[{selector:"app-piece-promotion-modal",template:'<div #myModal class="container">\r\n  <div class="wrapper">\r\n    <div class="content">\r\n      <div class="piece-wrapper">\r\n        <div class="piece" (click)="changeSelection(1)" [class.selected]="selectedIndex===1">&#x265B;</div>\r\n        <div class="piece" (click)="changeSelection(2)" [class.selected]="selectedIndex===2">&#x265C;</div>\r\n        <div class="piece" (click)="changeSelection(3)" [class.selected]="selectedIndex===3">&#x265D;</div>\r\n        <div class="piece" (click)="changeSelection(4)" [class.selected]="selectedIndex===4">&#x265E;</div>\r\n      </div>\r\n      <div style="text-align: center; margin-top: 5px">\r\n        <button (click)="close()" id="close-button">Promote!</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n',styles:[".container{display:none;position:absolute;z-index:1;top:0;color:#000;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.4)}.wrapper{position:relative;height:100%;width:100%}.content{background-color:#fefefe;margin:auto;position:relative;top:30%;font-size:100%;height:40%;padding:10px;border:1px solid #888;width:90%}.piece{font-size:5rem;height:100%;width:25%;cursor:pointer;display:inline-block}.piece-wrapper{height:80%;width:100%}#close-button{border-radius:4px;background-color:#4caf50;border:none;color:#fff;padding-left:5px;padding-right:5px;text-align:center;text-decoration:none;display:inline-block}.selected{border:2px solid #00b919;border-radius:4px;box-sizing:border-box}"]}]}],e.propDecorators={modal:[{type:t.ViewChild,args:["myModal",{static:!1}]}]},e}();var L=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.start.isEqual(e.start)&&this.end.isEqual(e.end)},e}();var M=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.isEqual=function(e){return e&&e.x===this.x&&this.y===e.y},e}();var x=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.drawPoint.isEqual(e.drawPoint)},e}();var _=function(){function e(){this._arrows=[],this._circles=[]}return e.prototype.addCircle=function(e){this.circles.push(e)},e.prototype.addArrow=function(e){this.arrows.push(e)},Object.defineProperty(e.prototype,"circles",{get:function(){return this._circles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arrows",{get:function(){return this._arrows},enumerable:!0,configurable:!0}),e.prototype.containsCircle=function(e){return this.circles.some((function(t){return t.isEqual(e)}))},e.prototype.containsArrow=function(e){return this.arrows.some((function(t){return t.isEqual(e)}))},e.prototype.clear=function(){this._arrows=[],this._circles=[]},e}();var S=function(){function e(e){this.ngxChessBoardService=e,this._size=A.DEFAULT_SIZE,this.darkTileColor=A.DEFAULT_DARK_TILE_COLOR,this.lightTileColor=A.DEFAULT_LIGHT_TILE_COLOR,this.showCoords=!0,this.dragDisabled=!1,this.drawDisabled=!1,this.onMove=new t.EventEmitter,this.selected=!1,this.coords=new H,this.disabling=!1,this.board=new C,this.boardLoader=new W(this.board),this.boardLoader.addPieces(),this.boardStateProvider=new k,this.moveHistoryProvider=new F,this.drawProvider=new _}return Object.defineProperty(e.prototype,"size",{set:function(e){e&&e>=A.MIN_BOARD_SIZE&&e<=A.MAX_BOARD_SIZE?this._size=e:this._size=A.DEFAULT_SIZE,this.drawProvider.clear(),this.calculatePieceSize()},enumerable:!0,configurable:!0}),e.prototype.onRightClick=function(e){e.preventDefault()},e.prototype.ngOnInit=function(){var e=this;this.ngxChessBoardService.componentMethodCalled$.subscribe((function(){e.board.reset()})),this.calculatePieceSize()},e.prototype.onMouseUp=function(e){return c(this,void 0,void 0,(function(){var t,i;return h(this,(function(o){if(1!==e.which&&!this.drawDisabled)return this.addDrawPoint(e.x,e.y),[2];if(this.drawProvider.clear(),this.dragDisabled)return[2];if(t=this.getClickPoint(e),this.board.activePiece&&t.isEqual(this.board.activePiece.point)&&this.disabling)return this.disableSelection(),this.disabling=!1,[2];if(this.selected)this.handleClickEvent(t);else if(i=this.getPieceByPoint(t.row,t.col)){if(this.board.currentWhitePlayer&&i.color===d.BLACK||!this.board.currentWhitePlayer&&i.color===d.WHITE)return[2];this.prepareActivePiece(i,t)}return[2]}))}))},e.prototype.afterMoveActions=function(){this.checkIfPawnFirstMove(this.board.activePiece),this.checkIfRookMoved(this.board.activePiece),this.checkIfKingMoved(this.board.activePiece),this.board.blackKingChecked=this.board.isKingInCheck(d.BLACK,this.board.pieces),this.board.whiteKingChecked=this.board.isKingInCheck(d.WHITE,this.board.pieces),this.checkForPossibleMoves(d.BLACK,"Checkmate!"),this.checkForPossibleMoves(d.WHITE,"Checkmate!"),this.board.calculateFEN(),this.checkForPat(d.BLACK),this.checkForPat(d.WHITE),this.disabling=!1},e.prototype.disableSelection=function(){this.selected=!1,this.board.possibleCaptures=[],this.board.activePiece=null,this.board.possibleMoves=[]},e.prototype.prepareActivePiece=function(e,t){this.board.activePiece=e,this.selected=!0,this.board.possibleCaptures=new m(e,t,this.board.currentWhitePlayer?d.WHITE:d.BLACK,this.board).getPossibleCaptures(),this.board.possibleMoves=new m(e,t,this.board.currentWhitePlayer?d.WHITE:d.BLACK,this.board).getPossibleMoves()},e.prototype.getPieceByPoint=function(e,t){return e=Math.floor(e),t=Math.floor(t),this.board.pieces.find((function(i){return i.point.col===t&&i.point.row===e}))},e.prototype.isKingChecked=function(e){if(e instanceof b)return e.color===d.WHITE?this.board.whiteKingChecked:this.board.blackKingChecked},e.prototype.getClickPoint=function(e){return new p(Math.floor((e.y-this.boardRef.nativeElement.getBoundingClientRect().top)/(this.boardRef.nativeElement.getBoundingClientRect().height/8)),Math.floor((e.x-this.boardRef.nativeElement.getBoundingClientRect().left)/(this.boardRef.nativeElement.getBoundingClientRect().width/8)))},e.prototype.movePiece=function(e,t){return c(this,void 0,void 0,(function(){var i;return h(this,(function(o){if(this.moveHistoryProvider.addMove(new B(g.format(e.point,t,this.board.reverted),e.constructor.name,e.color===d.WHITE?"white":"black")),(i=this.board.pieces.find((function(e){return e.point.col===t.col&&e.point.row===t.row})))&&e.color!=i.color)this.board.pieces=this.board.pieces.filter((function(e){return e!==i}));else if(i&&e.color===i.color)return[2];return e instanceof b&&Math.abs(t.col-e.point.col)>1&&(t.col<3?this.board.getPieceByField(e.point.row,0).point.col=3:this.board.getPieceByField(e.point.row,7).point.col=5),e instanceof w&&(this.checkIfPawnTakesEnPassant(t),this.checkIfPawnEnpassanted(e,t)),e.point=t,this.increaseFullMoveCount(),this.board.currentWhitePlayer=!this.board.currentWhitePlayer,[2,this.checkForPawnPromote(e)]}))}))},e.prototype.checkIfPawnFirstMove=function(e){e instanceof w&&(e.isMovedAlready=!0)},e.prototype.checkIfRookMoved=function(e){e instanceof u&&(e.isMovedAlready=!0)},e.prototype.checkIfKingMoved=function(e){e instanceof b&&(e.isMovedAlready=!0)},e.prototype.checkForPawnPromote=function(e){return c(this,void 0,void 0,(function(){return h(this,(function(t){return e instanceof w?(0!==e.point.row&&7!==e.point.row||(this.board.pieces=this.board.pieces.filter((function(t){return t!==e})),this.openPromoteDialog(e)),[2]):[2]}))}))},e.prototype.openPromoteDialog=function(e){return c(this,void 0,void 0,(function(){var t=this;return h(this,(function(i){return this.modal.open((function(i){var o=e.color===d.WHITE;switch(i){case 1:t.board.pieces.push(new y(e.point,e.color,o?f.WHITE_QUEEN:f.BLACK_QUEEN,t.board));break;case 2:t.board.pieces.push(new u(e.point,e.color,o?f.WHITE_ROOK:f.BLACK_ROOK,t.board));break;case 3:t.board.pieces.push(new E(e.point,e.color,o?f.WHITE_BISHOP:f.BLACK_BISHOP,t.board));break;case 4:t.board.pieces.push(new v(e.point,e.color,o?f.WHITE_KNIGHT:f.BLACK_KNIGHT,t.board));break;default:t.board.pieces.push(new y(e.point,e.color,o?f.WHITE_QUEEN:f.BLACK_QUEEN,t.board))}t.afterMoveActions()})),[2]}))}))},e.prototype.checkForPossibleMoves=function(e,t){var i=this;this.board.pieces.filter((function(t){return t.color===e})).some((function(t){return t.getPossibleMoves().some((function(o){return!g.willMoveCauseCheck(e,t.point.row,t.point.col,o.row,o.col,i.board)}))||t.getPossibleCaptures().some((function(o){return!g.willMoveCauseCheck(e,t.point.row,t.point.col,o.row,o.col,i.board)}))}))||alert(t)},e.prototype.checkForPat=function(e){(e!==d.WHITE||this.board.whiteKingChecked)&&(e!==d.BLACK||this.board.blackKingChecked)||this.checkForPossibleMoves(e,"Stalemate!")},e.prototype.checkIfPawnEnpassanted=function(e,t){Math.abs(e.point.row-t.row)>1?(this.board.enPassantPiece=e,this.board.enPassantPoint=new p((e.point.row+t.row)/2,e.point.col)):(this.board.enPassantPoint=null,this.board.enPassantPiece=null)},e.prototype.checkIfPawnTakesEnPassant=function(e){var t=this;e.isEqual(this.board.enPassantPoint)&&(this.board.pieces=this.board.pieces.filter((function(e){return e!==t.board.enPassantPiece})),this.board.enPassantPoint=null,this.board.enPassantPiece=null)},e.prototype.reset=function(){this.boardStateProvider.clear(),this.moveHistoryProvider.clear(),this.boardLoader.addPieces(),this.board.reset(),this.coords.reset(),this.drawProvider.clear()},e.prototype.reverse=function(){this.selected=!1,this.board.reverse(),this.coords.reverse()},e.prototype.saveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.boardStateProvider.addMove(new T(e))},e.prototype.undo=function(){if(!this.boardStateProvider.isEmpty()){var e=this.boardStateProvider.pop().board;this.board.reverted&&e.reverse(),this.board=e,this.boardLoader.setBoard(this.board),this.board.possibleCaptures=[],this.board.possibleMoves=[],this.moveHistoryProvider.pop()}},e.prototype.getMoveHistory=function(){return JSON.stringify(this.moveHistoryProvider.getAll())},e.prototype.calculatePieceSize=function(){this.pieceSize=this._size/10},e.prototype.setFEN=function(e){try{this.boardLoader.loadFEN(e)}catch(e){this.boardLoader.addPieces()}},e.prototype.getFEN=function(){return this.board.fen},e.prototype.increaseFullMoveCount=function(){this.board.currentWhitePlayer||++this.board.fullMoveCount},e.prototype.dragEnded=function(e){e.source.reset(),e.source.element.nativeElement.style.zIndex="0",e.source.element.nativeElement.style.pointerEvents="auto",e.source.element.nativeElement.style.touchAction="auto"},e.prototype.dragStart=function(e){var t=e.source.element.nativeElement.style;t.position="relative",t.zIndex="1000",t.touchAction="none",t.pointerEvents="none"},e.prototype.handleClickEvent=function(e){return c(this,void 0,void 0,(function(){var t;return h(this,(function(i){switch(i.label){case 0:return this.board.isPointInPossibleMoves(e)||this.board.isPointInPossibleCaptures(e)?(this.saveClone(),this.board.lastMoveSrc=new p(this.board.activePiece.point.row,this.board.activePiece.point.col),this.board.lastMoveDest=e,[4,this.movePiece(this.board.activePiece,e)]):[3,2];case 1:i.sent(),this.afterMoveActions(),this.onMove.emit(),i.label=2;case 2:if(this.disableSelection(),t=this.getPieceByPoint(e.row,e.col)){if(this.board.currentWhitePlayer&&t.color===d.BLACK||!this.board.currentWhitePlayer&&t.color===d.WHITE)return[2];this.prepareActivePiece(t,e)}return[2]}}))}))},e.prototype.onMouseDown=function(e){if(1===e.which){var t=this.getClickPoint(e);if(this.drawProvider.clear(),this.board.activePiece&&t.isEqual(this.board.activePiece.point))this.disabling=!0;else if(this.selected)this.handleClickEvent(t);else{var i=this.getPieceByPoint(t.row,t.col);if(i){if(this.board.currentWhitePlayer&&i.color===d.BLACK||!this.board.currentWhitePlayer&&i.color===d.WHITE)return;this.prepareActivePiece(i,t)}}}else this.drawPoint=this.getDrawingPoint(e.x,e.y)},e.prototype.getDrawingPoint=function(e,t){var i=this._size/8,o=Math.floor((e-this.boardRef.nativeElement.getBoundingClientRect().left)/i),r=Math.floor((t-this.boardRef.nativeElement.getBoundingClientRect().top)/i);return new M(Math.floor(o*i+i/2),Math.floor(r*i+i/2))},e.prototype.addDrawPoint=function(e,t){var i=this.getDrawingPoint(e,t);if(this.drawPoint.isEqual(i)){var o=new x;o.drawPoint=i,this.drawProvider.containsCircle(o)||this.drawProvider.addCircle(o)}else{var r=new L;r.start=this.drawPoint,r.end=i,this.drawProvider.containsArrow(r)||this.drawProvider.addArrow(r)}},e.decorators=[{type:t.Component,args:[{selector:"ngx-chess-board",template:'<div id="board" [style.height.px]="_size" [style.width.px]="_size" #boardRef (pointerdown)="onMouseDown($event)"\r\n     (pointerup)="onMouseUp($event)">\r\n  <div id="drag">\r\n    <div *ngFor="let row of board.board; let i = index" class="board-row">\r\n      <div *ngFor="let col of row; let j = index" class="board-col"\r\n           [style.background-color]="((i + j) %2 === 0 ) ?  lightTileColor : darkTileColor"\r\n           [ngClass]="[board.isXYInPointSelection(i,j) ? \'point-circle\':\'\',board.isXYInActiveMove(i,j) ? \'current-selection\':\'\' ,board.isXYInPossibleMoves(i,j) ? \'possible-point\' : \'\', board.isXYInPossibleCaptures(i,j) ? \'possible-capture\' : \'\',  isKingChecked(getPieceByPoint(i,j)) ? \'king-check\' : \'\', board.isXYInSourceMove(i,j)?\'source-move\':\'\',board.isXYInDestMove(i,j)?\'dest-move\':\'\']">\r\n        <span *ngIf="showCoords && j === 7" class="yCoord" [style.color]="(i % 2 === 0)? lightTileColor : darkTileColor"\r\n              [style.font-size.px]="pieceSize / 4">{{coords.yCoords[i]}}</span>\r\n        <span *ngIf="showCoords && i === 7" class="xCoord" [style.color]="(j % 2 === 0)? lightTileColor : darkTileColor"\r\n              [style.font-size.px]="pieceSize / 4">{{coords.xCoords[j]}}</span>\r\n        <div *ngIf="getPieceByPoint(i, j)" style="height:100%; width:100%">\r\n          <div cdkDrag\r\n               (cdkDragStarted)="dragStart($event)"\r\n               (cdkDragEnded)="dragEnded($event)"\r\n               [cdkDragDisabled]="dragDisabled"\r\n               class="piece" [style.font-size]="pieceSize + \'px\'" [innerHTML]="getPieceByPoint(i,j).image">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <svg [attr.width]="_size" [attr.height]="_size" style="position:absolute;top:0; pointer-events: none">\r\n\r\n    <defs>\r\n      <marker id="markerArrow" style="marker-offset: 20px" markerWidth="13" markerHeight="13" refX="10" refY="6"\r\n              orient="auto">\r\n        <path d="M2,2 L2,11 L10,6 L2,2" style="fill: #00ea0c;"/>\r\n      </marker>\r\n    </defs>\r\n    <line [attr.x1]="arrow.start.x" [attr.y1]="arrow.start.y" [attr.x2]="arrow.end.x" [attr.y2]="arrow.end.y"\r\n          class="arrow" *ngFor="let arrow of drawProvider.arrows"/>\r\n\r\n    <circle [attr.cx]="circle.drawPoint.x" [attr.cy]="circle.drawPoint.y" [attr.r]="_size/18" stroke="blueviolet"\r\n            stroke-width="0.8" fill-opacity="0.0" *ngFor="let circle of drawProvider.circles"/>\r\n  </svg>\r\n  <app-piece-promotion-modal #modal></app-piece-promotion-modal>\r\n\r\n</div>\r\n',styles:['@charset "UTF-8";#board{font-family:"Courier New",serif;position:relative}.board-row{display:block;width:100%;height:12.5%;position:relative}.board-col{position:relative;display:inline-block;width:12.5%;vertical-align:top;cursor:default;height:100%}.piece{height:100%;cursor:-webkit-grab;cursor:grab;width:100%;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;background-size:cover;justify-content:center;text-align:center;color:#000!important}.piece::after{content:"​"}#drag{height:100%;width:100%}.possible-point{border:3px solid #000;position:static;box-sizing:border-box}.possible-capture:hover,.possible-point:hover{opacity:.4}.possible-capture{border:3px solid #00ff2a;box-sizing:border-box}.king-check{border:3px solid red;box-sizing:border-box}.source-move{background-color:rgba(146,111,26,.79)!important}.dest-move{background-color:#b28e1a!important}.current-selection{background-color:#d3a91e!important}.yCoord{position:absolute;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;cursor:pointer;right:.2em;font-family:"Lucida Console",Courier,monospace;box-sizing:border-box}.xCoord{position:absolute;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;cursor:pointer;left:.2em;bottom:0;font-family:"Lucida Console",Courier,monospace;box-sizing:border-box}.hovering{background-color:red!important}.arrow{stroke:#00ea0c;stroke-width:2;marker-end:url(#markerArrow)}svg{-webkit-filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111);filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111)}']}]}],e.ctorParameters=function(){return[{type:I}]},e.propDecorators={size:[{type:t.Input,args:["size"]}],onRightClick:[{type:t.HostListener,args:["contextmenu",["$event"]]}],darkTileColor:[{type:t.Input,args:["darkTileColor"]}],lightTileColor:[{type:t.Input,args:["lightTileColor"]}],showCoords:[{type:t.Input,args:["showCoords"]}],dragDisabled:[{type:t.Input,args:["dragDisabled"]}],drawDisabled:[{type:t.Input,args:["drawDisabled"]}],onMove:[{type:t.Output}],boardRef:[{type:t.ViewChild,args:["boardRef",{static:!1}]}],modal:[{type:t.ViewChild,args:["modal",{static:!1}]}]},e}();var N=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[I]}},e.decorators=[{type:t.NgModule,args:[{declarations:[S,K],imports:[i.CommonModule,s.DragDropModule],exports:[S]}]}],e}();e.NgxChessBoardModule=N,e.NgxChessBoardService=I,e.ɵa=S,e.ɵb=K,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-chess-board.umd.min.js.map