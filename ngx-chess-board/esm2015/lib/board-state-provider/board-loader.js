/**
 * @fileoverview added by tsickle
 * Generated from: lib/board-state-provider/board-loader.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Pawn } from '../models/pieces/pawn';
import { Point } from '../models/pieces/point';
import { Color } from '../models/pieces/color';
import { UnicodeConstants } from '../utils/unicode-constants';
import { Rook } from '../models/pieces/rook';
import { Knight } from '../models/pieces/knight';
import { Bishop } from '../models/pieces/bishop';
import { Queen } from '../models/pieces/queen';
import { King } from '../models/pieces/king';
export class BoardLoader {
    /**
     * @param {?} board
     */
    constructor(board) {
        this.board = board;
    }
    /**
     * @return {?}
     */
    addPieces() {
        this.board.pieces = [];
        // piony czarne
        for (let i = 0; i < 8; ++i) {
            this.board.pieces.push(new Pawn(new Point(1, i), Color.BLACK, UnicodeConstants.BLACK_PAWN, this.board));
        }
        this.board.pieces.push(new Rook(new Point(0, 0), Color.BLACK, UnicodeConstants.BLACK_ROOK, this.board));
        this.board.pieces.push(new Knight(new Point(0, 1), Color.BLACK, UnicodeConstants.BLACK_KNIGHT, this.board));
        this.board.pieces.push(new Bishop(new Point(0, 2), Color.BLACK, UnicodeConstants.BLACK_BISHOP, this.board));
        this.board.pieces.push(new Queen(new Point(0, 3), Color.BLACK, UnicodeConstants.BLACK_QUEEN, this.board));
        this.board.pieces.push(new King(new Point(0, 4), Color.BLACK, UnicodeConstants.BLACK_KING, this.board));
        this.board.pieces.push(new Bishop(new Point(0, 5), Color.BLACK, UnicodeConstants.BLACK_BISHOP, this.board));
        this.board.pieces.push(new Knight(new Point(0, 6), Color.BLACK, UnicodeConstants.BLACK_KNIGHT, this.board));
        this.board.pieces.push(new Rook(new Point(0, 7), Color.BLACK, UnicodeConstants.BLACK_ROOK, this.board));
        // piony biale
        for (let i = 0; i < 8; ++i) {
            this.board.pieces.push(new Pawn(new Point(6, i), Color.WHITE, UnicodeConstants.WHITE_PAWN, this.board));
        }
        this.board.pieces.push(new Rook(new Point(7, 0), Color.WHITE, UnicodeConstants.WHITE_ROOK, this.board));
        this.board.pieces.push(new Knight(new Point(7, 1), Color.WHITE, UnicodeConstants.WHITE_KNIGHT, this.board));
        this.board.pieces.push(new Bishop(new Point(7, 2), Color.WHITE, UnicodeConstants.WHITE_BISHOP, this.board));
        this.board.pieces.push(new Queen(new Point(7, 3), Color.WHITE, UnicodeConstants.WHITE_QUEEN, this.board));
        this.board.pieces.push(new King(new Point(7, 4), Color.WHITE, UnicodeConstants.WHITE_KING, this.board));
        this.board.pieces.push(new Bishop(new Point(7, 5), Color.WHITE, UnicodeConstants.WHITE_BISHOP, this.board));
        this.board.pieces.push(new Knight(new Point(7, 6), Color.WHITE, UnicodeConstants.WHITE_KNIGHT, this.board));
        this.board.pieces.push(new Rook(new Point(7, 7), Color.WHITE, UnicodeConstants.WHITE_ROOK, this.board));
        this.board.calculateFEN();
    }
    /**
     * @param {?} fen
     * @return {?}
     */
    loadFEN(fen) {
        if (fen) {
            this.board.reverted = false;
            this.board.pieces = [];
            /** @type {?} */
            let split = fen.split('/');
            for (let i = 0; i < 8; ++i) {
                /** @type {?} */
                let pointer = 0;
                for (let j = 0; j < 8; ++j) {
                    /** @type {?} */
                    let chunk = split[i].charAt(j);
                    if (chunk.match(/[0-9]/)) {
                        pointer += Number(chunk);
                    }
                    else {
                        switch (chunk) {
                            case 'r':
                                this.board.pieces.push(new Rook(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_ROOK, this.board));
                                break;
                            case 'n':
                                this.board.pieces.push(new Knight(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_KNIGHT, this.board));
                                break;
                            case 'b':
                                this.board.pieces.push(new Bishop(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_BISHOP, this.board));
                                break;
                            case 'q':
                                this.board.pieces.push(new Queen(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_QUEEN, this.board));
                                break;
                            case 'k':
                                this.board.pieces.push(new King(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_KING, this.board));
                                break;
                            case 'p': {
                                /** @type {?} */
                                let pawn = new Pawn(new Point(i, pointer), Color.BLACK, UnicodeConstants.BLACK_PAWN, this.board);
                                if ((pawn.color === Color.BLACK && pawn.point.row !== 1) || (pawn.color === Color.WHITE && pawn.point.row !== 6)) {
                                    pawn.isMovedAlready = true;
                                }
                                this.board.pieces.push(pawn);
                                break;
                            }
                            case 'R':
                                this.board.pieces.push(new Rook(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_ROOK, this.board));
                                break;
                            case 'N':
                                this.board.pieces.push(new Knight(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_KNIGHT, this.board));
                                break;
                            case 'B':
                                this.board.pieces.push(new Bishop(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_BISHOP, this.board));
                                break;
                            case 'Q':
                                this.board.pieces.push(new Queen(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_QUEEN, this.board));
                                break;
                            case 'K':
                                this.board.pieces.push(new King(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_KING, this.board));
                                break;
                            case 'P': {
                                /** @type {?} */
                                let pawn = new Pawn(new Point(i, pointer), Color.WHITE, UnicodeConstants.WHITE_PAWN, this.board);
                                if ((pawn.color === Color.BLACK && pawn.point.row !== 1) || (pawn.color === Color.WHITE && pawn.point.row !== 6)) {
                                    pawn.isMovedAlready = true;
                                }
                                this.board.pieces.push(pawn);
                                break;
                            }
                        }
                        ++pointer;
                    }
                }
            }
            this.setCurrentPlayer(fen);
            this.setCastles(fen);
            this.setEnPassant(fen);
            this.setFullMoveCount(fen);
        }
        else {
            throw Error('Incorrect FEN provided');
        }
    }
    /**
     * @private
     * @param {?} fen
     * @return {?}
     */
    setCurrentPlayer(fen) {
        if (fen) {
            /** @type {?} */
            let split = fen.split(' ');
            this.board.currentWhitePlayer = split[1] === 'w';
        }
    }
    /**
     * @param {?} board
     * @return {?}
     */
    setBoard(board) {
        this.board = board;
    }
    /**
     * @private
     * @param {?} fen
     * @return {?}
     */
    setCastles(fen) {
        if (fen) {
            /** @type {?} */
            let split = fen.split(' ');
            /** @type {?} */
            let castleChunk = split[2];
            if (!castleChunk.includes('K')) {
                this.setRookAlreadyMoved(Color.WHITE, 7);
            }
            if (!castleChunk.includes('Q')) {
                this.setRookAlreadyMoved(Color.WHITE, 0);
            }
            if (!castleChunk.includes('k')) {
                this.setRookAlreadyMoved(Color.BLACK, 7);
            }
            if (!castleChunk.includes('q')) {
                this.setRookAlreadyMoved(Color.BLACK, 0);
            }
        }
    }
    /**
     * @private
     * @param {?} fen
     * @return {?}
     */
    setFullMoveCount(fen) {
    }
    /**
     * @private
     * @param {?} fen
     * @return {?}
     */
    setEnPassant(fen) {
        if (fen) {
            /** @type {?} */
            let split = fen.split(' ');
            /** @type {?} */
            let enPassantPoint = split[3];
            if (enPassantPoint === '-') {
                return;
            }
            // if()
        }
    }
    /**
     * @private
     * @param {?} color
     * @param {?} col
     * @return {?}
     */
    setRookAlreadyMoved(color, col) {
        /** @type {?} */
        let rook = (/** @type {?} */ (this.board.pieces.find((/**
         * @param {?} e
         * @return {?}
         */
        e => e.color === color && e instanceof Rook && e.point.col === col))));
        rook.isMovedAlready = true;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    BoardLoader.prototype.board;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9hcmQtbG9hZGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWNoZXNzLWJvYXJkLyIsInNvdXJjZXMiOlsibGliL2JvYXJkLXN0YXRlLXByb3ZpZGVyL2JvYXJkLWxvYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUMzQyxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDN0MsT0FBTyxFQUFDLEtBQUssRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQzdDLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUMzQyxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDL0MsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQy9DLE9BQU8sRUFBQyxLQUFLLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQUM3QyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFHM0MsTUFBTSxPQUFPLFdBQVc7Ozs7SUFJdEIsWUFBWSxLQUFZO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7Ozs7SUFFRCxTQUFTO1FBQ1AsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLGVBQWU7UUFDZixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzFCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDekc7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3hHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDNUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM1RyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDeEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM1RyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzVHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFHeEcsY0FBYztRQUNkLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDMUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUN6RztRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDeEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM1RyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzVHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDMUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN4RyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzVHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDNUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUV4RyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzVCLENBQUM7Ozs7O0lBRUQsT0FBTyxDQUFDLEdBQVc7UUFDakIsSUFBSSxHQUFHLEVBQUU7WUFDUCxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7WUFDNUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDOztnQkFDbkIsS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO1lBQzFCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7O29CQUN0QixPQUFPLEdBQUcsQ0FBQztnQkFDZixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFOzt3QkFDdEIsS0FBSyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUM5QixJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUU7d0JBQ3hCLE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7cUJBQzFCO3lCQUFNO3dCQUNMLFFBQVEsS0FBSyxFQUFFOzRCQUNiLEtBQUssR0FBRztnQ0FDTixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dDQUM5RyxNQUFNOzRCQUNSLEtBQUssR0FBRztnQ0FDTixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dDQUVsSCxNQUFNOzRCQUNSLEtBQUssR0FBRztnQ0FDTixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dDQUNsSCxNQUFNOzRCQUNSLEtBQUssR0FBRztnQ0FDTixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dDQUNoSCxNQUFNOzRCQUNSLEtBQUssR0FBRztnQ0FDTixJQUFJLENBQUMs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QUFDLE1BQU0sQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLEtBQUssSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLEdBQUcsRUFBQyxFQUFBO1FBQzVHLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO0lBQzdCLENBQUM7Q0FDRjs7Ozs7O0lBL0tDLDRCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UGF3bn0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9wYXduJztcclxuaW1wb3J0IHtQb2ludH0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9wb2ludCc7XHJcbmltcG9ydCB7Q29sb3J9IGZyb20gJy4uL21vZGVscy9waWVjZXMvY29sb3InO1xyXG5pbXBvcnQge1VuaWNvZGVDb25zdGFudHN9IGZyb20gJy4uL3V0aWxzL3VuaWNvZGUtY29uc3RhbnRzJztcclxuaW1wb3J0IHtSb29rfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL3Jvb2snO1xyXG5pbXBvcnQge0tuaWdodH0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9rbmlnaHQnO1xyXG5pbXBvcnQge0Jpc2hvcH0gZnJvbSAnLi4vbW9kZWxzL3BpZWNlcy9iaXNob3AnO1xyXG5pbXBvcnQge1F1ZWVufSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL3F1ZWVuJztcclxuaW1wb3J0IHtLaW5nfSBmcm9tICcuLi9tb2RlbHMvcGllY2VzL2tpbmcnO1xyXG5pbXBvcnQge0JvYXJkfSBmcm9tICcuLi9tb2RlbHMvYm9hcmQnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJvYXJkTG9hZGVyIHtcclxuICBwcml2YXRlIGJvYXJkOiBCb2FyZDtcclxuXHJcblxyXG4gIGNvbnN0cnVjdG9yKGJvYXJkOiBCb2FyZCkge1xyXG4gICAgdGhpcy5ib2FyZCA9IGJvYXJkO1xyXG4gIH1cclxuXHJcbiAgYWRkUGllY2VzKCkge1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMgPSBbXTtcclxuICAgIC8vIHBpb255IGN6YXJuZVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyArK2kpIHtcclxuICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUGF3bihuZXcgUG9pbnQoMSwgaSksIENvbG9yLkJMQUNLLCBVbmljb2RlQ29uc3RhbnRzLkJMQUNLX1BBV04sIHRoaXMuYm9hcmQpKTtcclxuICAgIH1cclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IFJvb2sobmV3IFBvaW50KDAsIDApLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19ST09LLCB0aGlzLmJvYXJkKSk7XHJcbiAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBLbmlnaHQobmV3IFBvaW50KDAsIDEpLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19LTklHSFQsIHRoaXMuYm9hcmQpKTtcclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IEJpc2hvcChuZXcgUG9pbnQoMCwgMiksIENvbG9yLkJMQUNLLCBVbmljb2RlQ29uc3RhbnRzLkJMQUNLX0JJU0hPUCwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUXVlZW4obmV3IFBvaW50KDAsIDMpLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19RVUVFTiwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgS2luZyhuZXcgUG9pbnQoMCwgNCksIENvbG9yLkJMQUNLLCBVbmljb2RlQ29uc3RhbnRzLkJMQUNLX0tJTkcsIHRoaXMuYm9hcmQpKTtcclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IEJpc2hvcChuZXcgUG9pbnQoMCwgNSksIENvbG9yLkJMQUNLLCBVbmljb2RlQ29uc3RhbnRzLkJMQUNLX0JJU0hPUCwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgS25pZ2h0KG5ldyBQb2ludCgwLCA2KSwgQ29sb3IuQkxBQ0ssIFVuaWNvZGVDb25zdGFudHMuQkxBQ0tfS05JR0hULCB0aGlzLmJvYXJkKSk7XHJcbiAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBSb29rKG5ldyBQb2ludCgwLCA3KSwgQ29sb3IuQkxBQ0ssIFVuaWNvZGVDb25zdGFudHMuQkxBQ0tfUk9PSywgdGhpcy5ib2FyZCkpO1xyXG5cclxuXHJcbiAgICAvLyBwaW9ueSBiaWFsZVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyArK2kpIHtcclxuICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUGF3bihuZXcgUG9pbnQoNiwgaSksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX1BBV04sIHRoaXMuYm9hcmQpKTtcclxuICAgIH1cclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IFJvb2sobmV3IFBvaW50KDcsIDApLCBDb2xvci5XSElURSwgVW5pY29kZUNvbnN0YW50cy5XSElURV9ST09LLCB0aGlzLmJvYXJkKSk7XHJcbiAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBLbmlnaHQobmV3IFBvaW50KDcsIDEpLCBDb2xvci5XSElURSwgVW5pY29kZUNvbnN0YW50cy5XSElURV9LTklHSFQsIHRoaXMuYm9hcmQpKTtcclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IEJpc2hvcChuZXcgUG9pbnQoNywgMiksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX0JJU0hPUCwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUXVlZW4obmV3IFBvaW50KDcsIDMpLCBDb2xvci5XSElURSwgVW5pY29kZUNvbnN0YW50cy5XSElURV9RVUVFTiwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgS2luZyhuZXcgUG9pbnQoNywgNCksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX0tJTkcsIHRoaXMuYm9hcmQpKTtcclxuICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IEJpc2hvcChuZXcgUG9pbnQoNywgNSksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX0JJU0hPUCwgdGhpcy5ib2FyZCkpO1xyXG4gICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgS25pZ2h0KG5ldyBQb2ludCg3LCA2KSwgQ29sb3IuV0hJVEUsIFVuaWNvZGVDb25zdGFudHMuV0hJVEVfS05JR0hULCB0aGlzLmJvYXJkKSk7XHJcbiAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBSb29rKG5ldyBQb2ludCg3LCA3KSwgQ29sb3IuV0hJVEUsIFVuaWNvZGVDb25zdGFudHMuV0hJVEVfUk9PSywgdGhpcy5ib2FyZCkpO1xyXG5cclxuICAgIHRoaXMuYm9hcmQuY2FsY3VsYXRlRkVOKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkRkVOKGZlbjogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmVuKSB7XHJcbiAgICAgIHRoaXMuYm9hcmQucmV2ZXJ0ZWQgPSBmYWxzZTtcclxuICAgICAgdGhpcy5ib2FyZC5waWVjZXMgPSBbXTtcclxuICAgICAgbGV0IHNwbGl0ID0gZmVuLnNwbGl0KCcvJyk7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgKytpKSB7XHJcbiAgICAgICAgbGV0IHBvaW50ZXIgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgODsgKytqKSB7XHJcbiAgICAgICAgICBsZXQgY2h1bmsgPSBzcGxpdFtpXS5jaGFyQXQoaik7XHJcbiAgICAgICAgICBpZiAoY2h1bmsubWF0Y2goL1swLTldLykpIHtcclxuICAgICAgICAgICAgcG9pbnRlciArPSBOdW1iZXIoY2h1bmspO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc3dpdGNoIChjaHVuaykge1xyXG4gICAgICAgICAgICAgIGNhc2UgJ3InOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUm9vayhuZXcgUG9pbnQoaSwgcG9pbnRlciksIENvbG9yLkJMQUNLLCBVbmljb2RlQ29uc3RhbnRzLkJMQUNLX1JPT0ssIHRoaXMuYm9hcmQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgS25pZ2h0KG5ldyBQb2ludChpLCBwb2ludGVyKSwgQ29sb3IuQkxBQ0ssIFVuaWNvZGVDb25zdGFudHMuQkxBQ0tfS05JR0hULCB0aGlzLmJvYXJkKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnYic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBCaXNob3AobmV3IFBvaW50KGksIHBvaW50ZXIpLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19CSVNIT1AsIHRoaXMuYm9hcmQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ3EnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUXVlZW4obmV3IFBvaW50KGksIHBvaW50ZXIpLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19RVUVFTiwgdGhpcy5ib2FyZCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnayc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBLaW5nKG5ldyBQb2ludChpLCBwb2ludGVyKSwgQ29sb3IuQkxBQ0ssIFVuaWNvZGVDb25zdGFudHMuQkxBQ0tfS0lORywgdGhpcy5ib2FyZCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAncCc6IHtcclxuICAgICAgICAgICAgICAgIGxldCBwYXduID0gbmV3IFBhd24obmV3IFBvaW50KGksIHBvaW50ZXIpLCBDb2xvci5CTEFDSywgVW5pY29kZUNvbnN0YW50cy5CTEFDS19QQVdOLCB0aGlzLmJvYXJkKTtcclxuICAgICAgICAgICAgICAgIGlmICgocGF3bi5jb2xvciA9PT0gQ29sb3IuQkxBQ0sgJiYgcGF3bi5wb2ludC5yb3cgIT09IDEpIHx8IChwYXduLmNvbG9yID09PSBDb2xvci5XSElURSAmJiBwYXduLnBvaW50LnJvdyAhPT0gNikpIHtcclxuICAgICAgICAgICAgICAgICAgcGF3bi5pc01vdmVkQWxyZWFkeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKHBhd24pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGNhc2UgJ1InOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgUm9vayhuZXcgUG9pbnQoaSwgcG9pbnRlciksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX1JPT0ssIHRoaXMuYm9hcmQpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdOJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuYm9hcmQucGllY2VzLnB1c2gobmV3IEtuaWdodChuZXcgUG9pbnQoaSwgcG9pbnRlciksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX0tOSUdIVCwgdGhpcy5ib2FyZCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgIGNhc2UgJ0InOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChuZXcgQmlzaG9wKG5ldyBQb2ludChpLCBwb2ludGVyKSwgQ29sb3IuV0hJVEUsIFVuaWNvZGVDb25zdGFudHMuV0hJVEVfQklTSE9QLCB0aGlzLmJvYXJkKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgY2FzZSAnUSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBRdWVlbihuZXcgUG9pbnQoaSwgcG9pbnRlciksIENvbG9yLldISVRFLCBVbmljb2RlQ29uc3RhbnRzLldISVRFX1FVRUVOLCB0aGlzLmJvYXJkKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgY2FzZSAnSyc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnBpZWNlcy5wdXNoKG5ldyBLaW5nKG5ldyBQb2ludChpLCBwb2ludGVyKSwgQ29sb3IuV0hJVEUsIFVuaWNvZGVDb25zdGFudHMuV0hJVEVfS0lORywgdGhpcy5ib2FyZCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgIGNhc2UgJ1AnOiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGF3biA9IG5ldyBQYXduKG5ldyBQb2ludChpLCBwb2ludGVyKSwgQ29sb3IuV0hJVEUsIFVuaWNvZGVDb25zdGFudHMuV0hJVEVfUEFXTiwgdGhpcy5ib2FyZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHBhd24uY29sb3IgPT09IENvbG9yLkJMQUNLICYmIHBhd24ucG9pbnQucm93ICE9PSAxKSB8fCAocGF3bi5jb2xvciA9PT0gQ29sb3IuV0hJVEUgJiYgcGF3bi5wb2ludC5yb3cgIT09IDYpKSB7XHJcbiAgICAgICAgICAgICAgICAgIHBhd24uaXNNb3ZlZEFscmVhZHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5waWVjZXMucHVzaChwYXduKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICArK3BvaW50ZXI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNldEN1cnJlbnRQbGF5ZXIoZmVuKTtcclxuICAgICAgdGhpcy5zZXRDYXN0bGVzKGZlbik7XHJcbiAgICAgIHRoaXMuc2V0RW5QYXNzYW50KGZlbik7XHJcbiAgICAgIHRoaXMuc2V0RnVsbE1vdmVDb3VudChmZW4pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhyb3cgRXJyb3IoJ0luY29ycmVjdCBGRU4gcHJvdmlkZWQnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBwcml2YXRlIHNldEN1cnJlbnRQbGF5ZXIoZmVuOiBzdHJpbmcpIHtcclxuICAgIGlmIChmZW4pIHtcclxuICAgICAgbGV0IHNwbGl0ID0gZmVuLnNwbGl0KCcgJyk7XHJcbiAgICAgIHRoaXMuYm9hcmQuY3VycmVudFdoaXRlUGxheWVyID0gc3BsaXRbMV0gPT09ICd3JztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEJvYXJkKGJvYXJkOiBCb2FyZCkge1xyXG4gICAgdGhpcy5ib2FyZCA9IGJvYXJkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRDYXN0bGVzKGZlbjogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmVuKSB7XHJcbiAgICAgIGxldCBzcGxpdCA9IGZlbi5zcGxpdCgnICcpO1xyXG4gICAgICBsZXQgY2FzdGxlQ2h1bmsgPSBzcGxpdFsyXTtcclxuXHJcbiAgICAgIGlmICghY2FzdGxlQ2h1bmsuaW5jbHVkZXMoJ0snKSkge1xyXG4gICAgICAgIHRoaXMuc2V0Um9va0FscmVhZHlNb3ZlZChDb2xvci5XSElURSwgNyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghY2FzdGxlQ2h1bmsuaW5jbHVkZXMoJ1EnKSkge1xyXG4gICAgICAgIHRoaXMuc2V0Um9va0FscmVhZHlNb3ZlZChDb2xvci5XSElURSwgMCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghY2FzdGxlQ2h1bmsuaW5jbHVkZXMoJ2snKSkge1xyXG4gICAgICAgIHRoaXMuc2V0Um9va0FscmVhZHlNb3ZlZChDb2xvci5CTEFDSywgNyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghY2FzdGxlQ2h1bmsuaW5jbHVkZXMoJ3EnKSkge1xyXG4gICAgICAgIHRoaXMuc2V0Um9va0FscmVhZHlNb3ZlZChDb2xvci5CTEFDSywgMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0RnVsbE1vdmVDb3VudChmZW46IHN0cmluZykge1xyXG5cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0RW5QYXNzYW50KGZlbjogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmVuKSB7XHJcbiAgICAgIGxldCBzcGxpdCA9IGZlbi5zcGxpdCgnICcpO1xyXG4gICAgICBsZXQgZW5QYXNzYW50UG9pbnQgPSBzcGxpdFszXTtcclxuXHJcbiAgICAgIGlmIChlblBhc3NhbnRQb2ludCA9PT0gJy0nKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBpZigpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFJvb2tBbHJlYWR5TW92ZWQoY29sb3I6IENvbG9yLCBjb2w6IG51bWJlcikge1xyXG4gICAgbGV0IHJvb2sgPSA8Um9vaz4gdGhpcy5ib2FyZC5waWVjZXMuZmluZChlID0+IGUuY29sb3IgPT09IGNvbG9yICYmIGUgaW5zdGFuY2VvZiBSb29rICYmIGUucG9pbnQuY29sID09PSBjb2wpO1xyXG4gICAgcm9vay5pc01vdmVkQWxyZWFkeSA9IHRydWU7XHJcbiAgfVxyXG59XHJcbiJdfQ==